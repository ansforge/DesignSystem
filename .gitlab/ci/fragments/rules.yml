# Rules template.
# @see https://docs.gitlab.com/ee/ci/yaml/#rules

################################################################################
# Git rules.
################################################################################
# develop branch run by a pipeline scheduler name's "develop"
.develop:
  rules:
    - if: $CI_COMMIT_BRANCH == "develop"
      variables:
        RELEASE_NAME: $CI_COMMIT_REF_SLUG
        PACKAGE_NAME: "ressources-${CI_COMMIT_REF_SLUG}.zip"


.syncho-github-ans:
  rules:
    - if: $CI_COMMIT_BRANCH == "syncho-github-ans"

# new tag
.tags:
  rules:
    - if: $CI_COMMIT_TAG
      variables:
        RELEASE_NAME: $CI_COMMIT_TAG
        PACKAGE_NAME: "ressources-${CI_COMMIT_TAG}.zip"

# run by a pipeline scheduler name's "audits" on choosen branch
.audits_rules:
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $SCHEDULER == "audits"'

# merge request restrictions to avoid check on other type of MR
.merge_request_restriction:
  rules:
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME == "develop"
      when: never
.merge_request:
  rules:
    - !reference [.merge_request_restriction, rules]
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"

################################################################################
# Build.
################################################################################
.build_rules:
  rules:
    - !reference [.develop, rules]
    - !reference [.tags, rules]

################################################################################
# Merge request.
################################################################################
.to_merge_php:
  rules:
    - !reference [.merge_request_restriction, rules]
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - "**/*.{php,module,install,profile,theme,yml,json,lock,twig}"
.to_merge_css:
  rules:
    - !reference [.merge_request_restriction, rules]
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - "web/themes/custom/**/*.{css,scss,json}"
