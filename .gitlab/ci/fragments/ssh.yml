################################################################################
# SSH Access.
################################################################################
.ssh:
  # Before deploy ssh private key need to be create in gitlab CI/CD variables
  # And ssh public key need to be add on ~/.ssh/authorized_keys files in VM wanted.
  before_script:
    - echo "Create ssh agent."
    - apk add openssh curl coreutils
    - eval $(ssh-agent -s)
    - echo "$SSH_PRIVATE_KEY_DEPLOY" | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - bash ${CI_PROJECT_DIR}/.gitlab/ci/teams_webhook/teams_notifications.sh "$SERVER_WEBHOOK_URL" "start" "$CI_JOB_NAME" "$GITLAB_USER_NAME" "$CI_JOB_STARTED_AT" "$CI_JOB_URL" "$CI_JOB_MANUAL"
  after_script:
    - bash ${CI_PROJECT_DIR}/.gitlab/ci/teams_webhook/teams_notifications.sh "$SERVER_WEBHOOK_URL" "$CI_JOB_STATUS" "$CI_JOB_NAME" "$GITLAB_USER_NAME" "$CI_JOB_STARTED_AT" "$CI_JOB_URL" "$CI_JOB_MANUAL"
