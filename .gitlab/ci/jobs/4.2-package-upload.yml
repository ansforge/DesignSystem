.package:upload:
  stage: packaging
  needs: ["package_generate"]
  extends: .package_variables
  rules:
  - !reference [.build_rules, rules]
  before_script:
    - apk add curl
    - curl --location --output /usr/local/bin/release-cli "https://gitlab.com/api/v4/projects/gitlab-org%2Frelease-cli/packages/generic/release-cli/latest/release-cli-linux-amd64"
    - sudo chmod +x /usr/local/bin/release-cli
  script: # upload to git externe packages
    - echo "${PACKAGE_REGISTRY_URL}/${RELEASE_NAME}/${PACKAGE_NAME}"
    - 'curl --header "PRIVATE-TOKEN: $EXTERNAL_GIT_TOKEN" --upload-file ${PACKAGE_NAME} "${PACKAGE_REGISTRY_URL}/${RELEASE_NAME}/${PACKAGE_NAME}"'
  release:
    name: 'Ressources $RELEASE_NAME'
    description: 'Ressources Package'
    tag_name: '$RELEASE_NAME'
    ref: '$CI_COMMIT_SHA'
